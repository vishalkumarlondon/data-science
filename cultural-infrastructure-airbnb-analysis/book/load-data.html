<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Load Data | Measuring the impact of cultural infrastructure on Airbnb listings in London</title>
  <meta name="description" content="This study uses cultural data science to measure the impact of cultural infrastructure on the supply and demand of Airbnb listings in London. The output format for this study is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.16.5 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Load Data | Measuring the impact of cultural infrastructure on Airbnb listings in London" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This study uses cultural data science to measure the impact of cultural infrastructure on the supply and demand of Airbnb listings in London. The output format for this study is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Load Data | Measuring the impact of cultural infrastructure on Airbnb listings in London" />
  
  <meta name="twitter:description" content="This study uses cultural data science to measure the impact of cultural infrastructure on the supply and demand of Airbnb listings in London. The output format for this study is bookdown::gitbook." />
  

<meta name="author" content="Vishal Kumar, Cultural Data Scientist" />


<meta name="date" content="2020-01-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="exploratory-data-analysis.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Measuring the impact of cultural infrastructure on Airbnb listings in London</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Abstract</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="load-data.html"><a href="load-data.html"><i class="fa fa-check"></i><b>3</b> Load Data</a><ul>
<li class="chapter" data-level="3.1" data-path="load-data.html"><a href="load-data.html#load-packages"><i class="fa fa-check"></i><b>3.1</b> Load packages</a></li>
<li class="chapter" data-level="3.2" data-path="load-data.html"><a href="load-data.html#download-data"><i class="fa fa-check"></i><b>3.2</b> Download data</a></li>
<li class="chapter" data-level="3.3" data-path="load-data.html"><a href="load-data.html#join-the-data"><i class="fa fa-check"></i><b>3.3</b> Join the data</a></li>
<li class="chapter" data-level="3.4" data-path="load-data.html"><a href="load-data.html#clean-variables-before-analysis"><i class="fa fa-check"></i><b>3.4</b> Clean variables before analysis</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>4</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#airbnb-eda"><i class="fa fa-check"></i><b>4.1</b> Airbnb EDA</a><ul>
<li class="chapter" data-level="4.1.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#airbnb-freqency-distributions"><i class="fa fa-check"></i><b>4.1.1</b> Airbnb freqency distributions</a></li>
<li class="chapter" data-level="4.1.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#airbnb-log-freqency-distributions"><i class="fa fa-check"></i><b>4.1.2</b> Airbnb log freqency distributions</a></li>
<li class="chapter" data-level="4.1.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#airbnb-inner-vs-outer-london"><i class="fa fa-check"></i><b>4.1.3</b> Airbnb Inner vs Outer London</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#cultural-infrastructure-eda"><i class="fa fa-check"></i><b>4.2</b> Cultural infrastructure EDA</a><ul>
<li class="chapter" data-level="4.2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#cultural-infrastructure-frequency-distributions"><i class="fa fa-check"></i><b>4.2.1</b> Cultural infrastructure frequency distributions</a></li>
<li class="chapter" data-level="4.2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#cultural-infrastructure-log-distibutions"><i class="fa fa-check"></i><b>4.2.2</b> Cultural infrastructure log distibutions</a></li>
<li class="chapter" data-level="4.2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#all-variables"><i class="fa fa-check"></i><b>4.2.3</b> All variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>5</b> Maps</a><ul>
<li class="chapter" data-level="5.1" data-path="maps.html"><a href="maps.html#culture-dot-map"><i class="fa fa-check"></i><b>5.1</b> Culture dot map</a></li>
<li class="chapter" data-level="5.2" data-path="maps.html"><a href="maps.html#culture-frequency-density-map"><i class="fa fa-check"></i><b>5.2</b> Culture frequency density map</a></li>
<li class="chapter" data-level="5.3" data-path="maps.html"><a href="maps.html#culture-rating-density-map"><i class="fa fa-check"></i><b>5.3</b> Culture rating density map</a></li>
<li class="chapter" data-level="5.4" data-path="maps.html"><a href="maps.html#airbnb-freq-density-map---supply-demand"><i class="fa fa-check"></i><b>5.4</b> Airbnb freq density map - Supply &amp; Demand</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>6</b> Regression</a><ul>
<li class="chapter" data-level="6.1" data-path="regression.html"><a href="regression.html#gloabl-regression-models"><i class="fa fa-check"></i><b>6.1</b> Gloabl Regression Models</a></li>
<li class="chapter" data-level="6.2" data-path="regression.html"><a href="regression.html#spatial-lag-regression-model"><i class="fa fa-check"></i><b>6.2</b> Spatial lag regression model</a></li>
<li class="chapter" data-level="6.3" data-path="regression.html"><a href="regression.html#geographically-weighted-regression-models-gwr"><i class="fa fa-check"></i><b>6.3</b> Geographically Weighted Regression Models (GWR)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Measuring the impact of cultural infrastructure on Airbnb listings in London</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="load-data" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Load Data</h1>
<div id="load-packages" class="section level2">
<h2><span class="header-section-number">3.1</span> Load packages</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----load all the libraries needed</span>
<span class="kw">library</span>(sf)
<span class="kw">library</span>(plyr)
<span class="kw">library</span>(pins)
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(tidyr)
<span class="kw">library</span>(sp)
<span class="co">#library(spdep)</span>

<span class="kw">options</span>(<span class="dt">scipen =</span> <span class="dv">999</span>)</code></pre></div>
</div>
<div id="download-data" class="section level2">
<h2><span class="header-section-number">3.2</span> Download data</h2>
<p><strong>1. Download Airbnb data</strong></p>
<p>I collected every Airbnb “listings.csv” file for London from the website Inside Airbnb (<a href="http://insideairbnb.com/get-the-data.html" class="uri">http://insideairbnb.com/get-the-data.html</a>) for the years 2017 and 2018, concatinated them all together and put it here (github link) on this project’s GitHub repo. In total, there are 242,490 unqiue listings with 14 columns of attributes. None of that raw data has had any post processing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----read in Airbnb London listings data from the project GitHub repo as a dataframe</span>
airbnb &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/airbnb-london-2017-2018.csv&quot;</span>)
<span class="kw">print</span>(<span class="kw">dim</span>(airbnb))</code></pre></div>
<pre><code>## [1] 242490     14</code></pre>
<p>This study does not look at the temporal change in price - i.e. the price difference between 2017 to 2018 - as the dependent variable. Rather, it averages out the price for each unique listing (by id) between 2017 and 2018. By doing this, adjustments for natural fluctations - for instance, seasonality - are averaged out. Future research may study dive deeper into the differences in price across time and season.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----create a new dataframe by grouping the listings id and creating an average price column</span>
price_average &lt;-<span class="st"> </span>airbnb %&gt;%<span class="st">  </span><span class="kw">group_by</span>(id) %&gt;%<span class="st"> </span><span class="kw">summarise</span>(<span class="dt">price =</span> <span class="kw">mean</span>(price))

<span class="kw">colnames</span>(price_average) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;price_average&quot;</span>)

<span class="co">#----join the new dataframe to the original Airbnb data to add a column for the average price per listing between 2017 and 2018</span>
airbnb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(airbnb, price_average, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;id&#39;</span>))

<span class="co">#----keep the original Airbnb data my making a `airbnb_old` dataframe</span>
airbnb_old &lt;-<span class="st"> </span>airbnb

<span class="co">#----remove unnecessary columns and remove duplicate listing ids to leave unique listings with average price between 2017 and 2018</span>
<span class="co">#airbnb &lt;- airbnb[, ! colnames(airbnb) %in% c(&quot;price&quot;, &quot;last_review&quot;, &quot;year&quot;, &quot;month&quot;, &quot;day&quot;)]</span>
airbnb &lt;-<span class="st"> </span>airbnb[, !<span class="st"> </span><span class="kw">colnames</span>(airbnb) %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;price&quot;</span>)]
airbnb &lt;-<span class="st"> </span>airbnb[!<span class="kw">duplicated</span>(airbnb[<span class="kw">c</span>(<span class="st">&quot;id&quot;</span>)]),]

<span class="co">#----turn Airbnb datafram into an sf</span>
airbnb &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(airbnb, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>)
airbnb &lt;-<span class="st"> </span><span class="kw">st_transform</span>(airbnb, <span class="dv">27700</span>)</code></pre></div>
<p>At this stage, outliers in price are removed, this is because the average price for some listings went as high as £10,000. All listings that had an average price 2.58 times the mean were removed. Moreover, prices recorded as zero were also removed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----calculate the mean, min and max and std of the Airbnb prices for the whole of London</span>
<span class="kw">print</span>(<span class="kw">summary</span>(airbnb$price_average))</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.0    45.0    80.0   100.8   125.0  9999.0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airbnb_price_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(airbnb$price_average)
airbnb_price_std &lt;-<span class="st"> </span><span class="kw">sd</span>(airbnb$price_average)
airbnb_price_mad &lt;-<span class="st"> </span><span class="kw">mad</span>(airbnb$price_average)

<span class="co">#----then remove Airbnb where the price is two standard deviations away from the mean - i.e. outliers</span>
airbnb &lt;-<span class="st"> </span><span class="kw">subset</span>(airbnb, price_average &lt;<span class="st"> </span>(airbnb_price_mean+(<span class="fl">2.58</span>*airbnb_price_std)) &amp;<span class="st"> </span>price_average &gt;<span class="st"> </span>(airbnb_price_mean-(<span class="fl">2.58</span>*airbnb_price_std)))
<span class="co">#----then remove Airbnb where the price is zero</span>
airbnb &lt;-<span class="st"> </span>airbnb[airbnb$price_average !=<span class="st"> </span><span class="dv">0</span>,]

<span class="kw">print</span>(<span class="kw">summary</span>(airbnb$price_average))</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    5.00   45.00   79.00   93.08  120.00  397.00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----calculate the mean, min and max and std of the Airbnb prices for the whole of London</span>
<span class="kw">print</span>(<span class="kw">summary</span>(airbnb$price_average))</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    5.00   45.00   79.00   93.08  120.00  397.00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airbnb_price_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(airbnb$price_average)
airbnb_price_std &lt;-<span class="st"> </span><span class="kw">sd</span>(airbnb$price_average)
airbnb_price_mad &lt;-<span class="st"> </span><span class="kw">mad</span>(airbnb$price_average)

<span class="co">#----then remove Airbnb where the price is two standard deviations away from the mean - i.e. outliers</span>
airbnb &lt;-<span class="st"> </span><span class="kw">subset</span>(airbnb, price_average &lt;<span class="st"> </span>(airbnb_price_mean+(<span class="fl">2.58</span>*airbnb_price_std)) &amp;<span class="st"> </span>price_average &gt;<span class="st"> </span>(airbnb_price_mean-(<span class="fl">2.58</span>*airbnb_price_std)))
<span class="co">#----then remove Airbnb where the price is zero</span>
airbnb &lt;-<span class="st"> </span>airbnb[airbnb$price_average !=<span class="st"> </span><span class="dv">0</span>,]

<span class="kw">print</span>(<span class="kw">summary</span>(airbnb$price_average))</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    5.00   44.50   75.00   86.82  120.00  258.50</code></pre>
<p><strong>2. Download Cultural Infrastructure data</strong></p>
<p>I collected data for every cultural venue in London by borough from data.london.gov (<a href="https://data.london.gov.uk/dataset/cultural-infrastructure-map" class="uri">https://data.london.gov.uk/dataset/cultural-infrastructure-map</a>). Specifically, the “Cultural venues by London borough” zip file was downloaded and then all the files were concatinated. In total there were 10,003 cultural venues in London.</p>
<p>This entire dataset was then passed to the Google Places API to calculate the average user rating and total number of reviews for each venue. The total run time to recieve a ratings and reviews took 90 minutes, which is why it was much more efficient to calculated these metrics outside of this R script. For more information on the Google Place API, please visit this link (X)</p>
<p>1,958 venues out of the 10,003 total did not possess any, or had zero, user ratings and reviews on Google Places and were therefore dropped leaving 8,045 venues remaining for the analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----read in the Cultural Infrastructure data from porject GitHubb</span>
culture &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/all-cultural-infra-map-google-places.csv&quot;</span>)

<span class="kw">print</span>(<span class="kw">dim</span>(culture))</code></pre></div>
<pre><code>## [1] 10003    25</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">colSums</span>(<span class="kw">is.na</span>(culture)))</code></pre></div>
<pre><code>##             BOROUGH Cultural.Venue.Type           site_name            address1 
##                   0                   0                   0                   0 
##            address2            address3        borough_code        borough_name 
##                   0                   0                   0                   0 
##            latitude           longitude             easting            northing 
##                   0                   0                   0                   0 
## os_addressbase_uprn      ward_2018_code      ward_2018_name             website 
##                4273                   0                   0                   0 
##            gss_code             runtime        API_response   formatted_address 
##                   0                   0                   0                   0 
##                name            place_id              rating               types 
##                   0                   0                1556                   0 
##  user_ratings_total 
##                1556</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">dim</span>(culture[culture$rating ==<span class="st"> </span><span class="dv">0</span>, ]))</code></pre></div>
<pre><code>## [1] 1958   25</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----only keep rows from Cultural Infrastructure if the longitude cell is filled in (i.e. not Null)</span>
culture &lt;-<span class="st"> </span>culture[<span class="kw">complete.cases</span>(culture$longitude), ]

<span class="co">#----only keep rows from Cultural Infrastructure  if the rating cell is filled in (i.e. not Null)</span>
culture &lt;-<span class="st"> </span>culture[!<span class="kw">is.na</span>(<span class="kw">as.numeric</span>(<span class="kw">as.character</span>(culture$rating))),]

<span class="co">#----only keep rows from Cultural Infrastructure  if the rating cell is not 0</span>
culture &lt;-<span class="st"> </span>culture[culture$rating !=<span class="st"> </span><span class="dv">0</span>, ]

<span class="co">#----turn the Cultural Infrastructure dataframe into an sf object</span>
culture &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(culture, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>),  <span class="dt">crs =</span> <span class="dv">4326</span>)
culture &lt;-<span class="st"> </span><span class="kw">st_transform</span>(culture, <span class="dv">27700</span>)

<span class="co">#culture_withPubs &lt;- culture</span>
<span class="co">#culture &lt;- culture[!culture$Cultural.Venue.Type == &#39;Pubs&#39;,]</span></code></pre></div>
<p><strong>3. Download London shapefile data</strong></p>
<p>The GIS shapefile boundaries for London were downloaded from data.london (<a href="https://data.london.gov.uk/dataset/statistical-gis-boundary-files-london" class="uri">https://data.london.gov.uk/dataset/statistical-gis-boundary-files-london</a>). This research is interested in studying the Lower Super Output Area (LSOA) 2011 boundary area, however, Ward and Borough level shape files were also stored in a list if necessary. In total there are 4,835 LSOA areas.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----the following code has been adapted from (MacLachlan &amp; Dennett, 2019: Section 10.4.1)</span>

<span class="co">#----use the pin function from the pins package to store the GIS London boundary .zip files from data.london</span>
pin_london_GIS &lt;-<span class="st"> </span><span class="kw">pin</span>(<span class="st">&quot;https://data.london.gov.uk/download/statistical-gis-boundary-files-london/9ba8c833-6370-4b11-abdc-314aa020d5e0/statistical-gis-boundaries-london.zip&quot;</span>)

<span class="co">#----grab the shape files for Borough, Ward and LSOA based on their string values and cache</span>
s &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;Borough|Ward_|LSOA_2011&quot;</span>, pin_london_GIS) &amp;<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;.shp$&quot;</span>, pin_london_GIS)

<span class="co">#----create a list for Borough, Ward and LSOA shape files</span>
BoroughsWardsLSOA &lt;-<span class="st"> </span>pin_london_GIS[s]

<span class="co">#----turn each element in the list into a SF file using the st_read function</span>
BoroughsWardsLSOAsf &lt;-<span class="st"> </span><span class="kw">lapply</span>(BoroughsWardsLSOA, st_read)</code></pre></div>
<pre><code>## Reading layer `London_Borough_Excluding_MHW&#39; from data source `/Users/vishalkumar.london/Library/Caches/pins/local/statistical_gis_boundaries_london/statistical-gis-boundaries-london/ESRI/London_Borough_Excluding_MHW.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 33 features and 7 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 503568.2 ymin: 155850.8 xmax: 561957.5 ymax: 200933.9
## epsg (SRID):    27700
## proj4string:    +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs
## Reading layer `London_Ward_CityMerged&#39; from data source `/Users/vishalkumar.london/Library/Caches/pins/local/statistical_gis_boundaries_london/statistical-gis-boundaries-london/ESRI/London_Ward_CityMerged.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 625 features and 7 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 503568.2 ymin: 155850.8 xmax: 561957.5 ymax: 200933.9
## epsg (SRID):    27700
## proj4string:    +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs
## Reading layer `LSOA_2011_London_gen_MHW&#39; from data source `/Users/vishalkumar.london/Library/Caches/pins/local/statistical_gis_boundaries_london/statistical-gis-boundaries-london/ESRI/LSOA_2011_London_gen_MHW.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 4835 features and 14 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 503574.2 ymin: 155850.8 xmax: 561956.7 ymax: 200933.6
## epsg (SRID):    27700
## proj4string:    +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BoroughsWardsLSOAsf &lt;-<span class="st"> </span><span class="kw">lapply</span>(BoroughsWardsLSOAsf, <span class="dt">crs=</span><span class="dv">27700</span>, st_transform)

<span class="co">#----create a variable for LSOAs in London by selecting the third element in the list</span>
londonLSOA &lt;-<span class="st"> </span>BoroughsWardsLSOAsf[[<span class="dv">3</span>]]
londonWard &lt;-<span class="st"> </span>BoroughsWardsLSOAsf[[<span class="dv">2</span>]]
londonBorough &lt;-<span class="st"> </span>BoroughsWardsLSOAsf[[<span class="dv">1</span>]]</code></pre></div>
<p><strong>4. Download the LSOA profile data</strong></p>
<p>The LSOA atlas (<a href="https://data.london.gov.uk/dataset/lsoa-atlas" class="uri">https://data.london.gov.uk/dataset/lsoa-atlas</a>) provides a summary of demographic and related data for each Lower Super Output Area in Greater London. Some of this attribbute data for each LSOA will be useful as independent variable later in the analysis. This data is downloaded from data.london and subset by 15 columns which are most relevant as per Dudas et al’s (2017) paper.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----run the code below if you want to read in LSOA attribute data using the current 2011 boundaries</span>
<span class="co">#----NOTE: There is comparatively less data for the new boundaries compared with the old boundaries</span>

londonLSOAProfiles &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://data.london.gov.uk/download/lsoa-atlas/0193f884-2ccd-49c2-968e-28aa3b1c480d/lsoa-data.csv&quot;</span>, <span class="dt">na =</span> <span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;NA&quot;</span>, <span class="st">&quot;n/a&quot;</span>), <span class="dt">locale =</span> <span class="kw">locale</span>(<span class="dt">encoding =</span> <span class="st">&#39;Latin1&#39;</span>), <span class="dt">col_names =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Warning: 2 parsing failures.
##  row                                col expected actual                                                                                                file
## 1348 House Prices;Median Price (£);2014 a double      . &#39;https://data.london.gov.uk/download/lsoa-atlas/0193f884-2ccd-49c2-968e-28aa3b1c480d/lsoa-data.csv&#39;
## 2873 House Prices;Median Price (£);2014 a double      . &#39;https://data.london.gov.uk/download/lsoa-atlas/0193f884-2ccd-49c2-968e-28aa3b1c480d/lsoa-data.csv&#39;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">select.me &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Lower Super Output Area&#39;</span>,
               <span class="st">&#39;Population Density;Area (Hectares);&#39;</span>,
               <span class="st">&#39;Population Density;Persons per hectare;2013&#39;</span>,
               <span class="st">&#39;Ethnic Group;BAME (%);2011&#39;</span>,
               <span class="st">&#39;Country of Birth;% Not United Kingdom;2011&#39;</span>,
               <span class="st">&#39;Tenure;Owned outright (%);2011&#39;</span>,
               <span class="st">&#39;Tenure;Owned with a mortgage or loan (%);2011&#39;</span>,
               <span class="st">&#39;House Prices;Median Price (£);2014&#39;</span>,
               <span class="st">&#39;Economic Activity;Employment Rate;2011&#39;</span>,
               <span class="st">&#39;Qualifications;% Highest level of qualification: Level 4 qualifications and above;2011&#39;</span>,
               <span class="st">&#39;Household Income, 2011/12;Median Annual Household Income estimate (£)&#39;</span>,
               <span class="st">&#39;Public Transport Accessibility Levels (2014);% 4-6 (good access)&#39;</span>,
               <span class="st">&#39;2013 Census Population;Age Structure;16-29&#39;</span>,
               <span class="st">&#39;2014 Census Population;Age Structure;30-44&#39;</span>,
               <span class="st">&#39;Dwelling type;All Households;2011&#39;</span>)

londonLSOAProfiles &lt;-<span class="st"> </span>londonLSOAProfiles[,select.me]</code></pre></div>
<p><strong>5. Download Inner/Outer London boundaries</strong></p>
<p>It will be useful to compare Airbnb lisitings and cultural infrastructure in Inner London vs Outer London as it is likely that the freqncy, price and average ratings of the former will all be higher than the later.</p>
<p>Download the Inner/Outer London boundaries from data.london</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----use the pin function from the pins package to store the Inner and Outer London boundary .zip files from data.london</span>
pin_inner_outer &lt;-<span class="st"> </span><span class="kw">pin</span>(<span class="st">&quot;https://data.london.gov.uk/download/inner-and-outer-london-boundaries-london-plan-consultation-2009/684e59f2-9208-4da1-bf67-d8dfeb72c047/lp-consultation-oct-2009-inner-outer-london-shp.zip&quot;</span>)

<span class="co">#----pull out the Inner and Outer London shapefile</span>
i_o &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;lp-consultation-oct-2009-inner-outer&quot;</span>, pin_inner_outer) &amp;<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;.shp$&quot;</span>, pin_inner_outer)

<span class="co">#----create a list for the shape file</span>
inner_outer &lt;-<span class="st"> </span>pin_inner_outer[i_o]

<span class="co">#----turn the shapefile into a SF file using the st_read function</span>
inner_outerSF &lt;-<span class="st"> </span><span class="kw">st_read</span>(inner_outer)</code></pre></div>
<pre><code>## Reading layer `lp-consultation-oct-2009-inner-outer-london&#39; from data source `/Users/vishalkumar.london/Library/Caches/pins/local/lp_consultation_oct_2009_inner_outer_london_shp/lp-consultation-oct-2009-inner-outer-london.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 2 features and 5 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 503568.2 ymin: 155850.8 xmax: 561957.5 ymax: 200933.9
## epsg (SRID):    27700
## proj4string:    +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_transform</span>(inner_outerSF, <span class="dv">27700</span>)</code></pre></div>
<pre><code>## Simple feature collection with 2 features and 5 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 503568.2 ymin: 155850.8 xmax: 561957.5 ymax: 200933.9
## epsg (SRID):    27700
## proj4string:    +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs
##       Boundary                         Source  Area_Ha Shape_Leng Shape_Area
## 1 Inner London London Plan Consultation Draft  34863.3   117020.7  348632957
## 2 Outer London London Plan Consultation Draft 124606.8   373367.7 1246068121
##                         geometry
## 1 POLYGON ((522055.6 178014.7...
## 2 POLYGON ((503611.2 175520.4...</code></pre>
</div>
<div id="join-the-data" class="section level2">
<h2><span class="header-section-number">3.3</span> Join the data</h2>
<p><strong>1. Join Airbnb data with LSOA shapefile</strong></p>
<p>The functions below join the Airbnb data to the LSOA areas in London and a) count the number of Airbnb listings per LSOA, b) calculating the average price of Airbnb lisitngs per LSOA, c) counting the number of Airbnb user reviews per LSOA, and d) calculating the average number of Airbnb user reviews per LSOA.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">JoinAirbnb_count &lt;-<span class="st"> </span>function(data1, data2) {
  <span class="co">#----join dataframes</span>
  joined &lt;-<span class="st"> </span><span class="kw">st_join</span>(data1, data2, <span class="dt">join =</span> st_within)
  <span class="co">#----count the number of points per LSOA</span>
  count &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(plyr::<span class="kw">count</span>(joined$LSOA11CD))
  <span class="kw">names</span>(count) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;LSOA11CD&quot;</span>, <span class="st">&quot;airbnb_freq&quot;</span>)
  <span class="kw">return</span>(count)
}

JoinAirbnb_price &lt;-<span class="st"> </span>function(data1, data2) {
  <span class="co">#----join dataframes</span>
  joined &lt;-<span class="st"> </span><span class="kw">st_join</span>(data1, data2, <span class="dt">join =</span> st_within)
  <span class="co">#----calculate the average price of Airbnb per LSOA</span>
  price &lt;-<span class="st"> </span><span class="kw">aggregate</span>(price_average~LSOA11CD, joined, mean)
  <span class="kw">names</span>(price) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;LSOA11CD&quot;</span>, <span class="st">&quot;airbnb_price&quot;</span>)
  <span class="kw">return</span>(price)
}

JoinAirbnb_NOreviews &lt;-<span class="st"> </span>function(data1, data2) {
    <span class="co">#----join dataframes</span>
  joined &lt;-<span class="st"> </span><span class="kw">st_join</span>(data1, data2, <span class="dt">join =</span> st_within)
  <span class="co">#----calculate the average price of Airbnb per LSOA</span>
  reviews &lt;-<span class="st"> </span><span class="kw">aggregate</span>(number_of_reviews~LSOA11CD, joined, sum)
  <span class="kw">names</span>(reviews) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;LSOA11CD&quot;</span>, <span class="st">&quot;airbnb_no_reviews&quot;</span>)
  <span class="kw">return</span>(reviews)
}

JoinAirbnb_AVreviews &lt;-<span class="st"> </span>function(data1, data2) {
    <span class="co">#----join dataframes</span>
  joined &lt;-<span class="st"> </span><span class="kw">st_join</span>(data1, data2, <span class="dt">join =</span> st_within)
  <span class="co">#----calculate the average price of Airbnb per LSOA</span>
  reviews &lt;-<span class="st"> </span><span class="kw">aggregate</span>(number_of_reviews~LSOA11CD, joined, mean)
  <span class="kw">names</span>(reviews) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;LSOA11CD&quot;</span>, <span class="st">&quot;airbnb_av_reviews&quot;</span>)
  <span class="kw">return</span>(reviews)
}


<span class="co">#----////////////////////////////////////////////////////////////////////////</span>


<span class="co">#----AIRBNB COUNT----#</span>
<span class="co">#----use the first function to count the number of Airbnbs in each LSOA</span>
airbnbLSOA_count &lt;-<span class="st"> </span><span class="kw">JoinAirbnb_count</span>(airbnb, londonLSOA)

<span class="co">#----AIRBNB PRICE----#</span>
<span class="co">#----use the second function to calculate the average price of Airbnb listings in each LSOA</span>
airbnbLSOA_price &lt;-<span class="st"> </span><span class="kw">JoinAirbnb_price</span>(airbnb, londonLSOA)

<span class="co">#----AIRBNB NUMBER OF REVIEWS----#</span>
<span class="co">#----use the third function to count the number of Airbnb reviews in each LSOA</span>
airbnbLSOA_review_count &lt;-<span class="st"> </span><span class="kw">JoinAirbnb_NOreviews</span>(airbnb, londonLSOA)

<span class="co">#----AIRBNB AVERAGE NUMBER OF REVIEWS----#</span>
<span class="co">#----use the fourth function to calculate the average number of Airbnb reviews in each LSOA</span>
airbnbLSOA_review_average &lt;-<span class="st"> </span><span class="kw">JoinAirbnb_AVreviews</span>(airbnb, londonLSOA)</code></pre></div>
<p><strong>2. Join Culture data with LSOA shapefile</strong></p>
<p>The functions below join the Cultural Infrastructure data to the LSOA areas in London and a) count the number of Cultural Infrastructure by cultural venue type per LSOA, b) calculating the average Google Places user rating by cultural venue type per LSOA, c) calculating the average number of Google Places user reviews by cultural venue type per LSOA, and d) counting the total number of Google Places user reviews by cultural venue type per LSOA.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">JoinCulture_count &lt;-<span class="st"> </span>function(data1, data2) {
  <span class="co">#----join dataframes</span>
  joined &lt;-<span class="st"> </span><span class="kw">st_join</span>(data1, data2, <span class="dt">join =</span> st_within)
  <span class="co">#----count the number cultural venue types per LSOA</span>
  <span class="co">#source----https://stackoverflow.com/questions/10879551/frequency-count-of-two-column-in-r</span>
  count &lt;-<span class="st"> </span><span class="kw">ddply</span>(joined, .(joined$LSOA11CD, joined$Cultural.Venue.Type), nrow)
  <span class="kw">names</span>(count) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;LSOA11CD&quot;</span>, <span class="st">&quot;cultural_venue_type&quot;</span>, <span class="st">&quot;culture_freq&quot;</span>)
  <span class="co">#----then use the spread function from the tidyr lib to turn long data into wide data - i.e. a column for each cultural venue type</span>
  <span class="co">#source----https://uc-r.github.io/tidyr</span>
  count &lt;-<span class="st"> </span>count %&gt;%<span class="st"> </span><span class="kw">spread</span>(cultural_venue_type, culture_freq)
  <span class="co">#----then use the rowSums function to sum up the counts from all cultural venue type, skip NA values and create new column</span>
  count$culture_freq &lt;-<span class="st"> </span><span class="kw">rowSums</span>(count[,<span class="kw">sapply</span>(count, is.numeric)], <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
  <span class="kw">return</span>(count)
}

JoinCulture_rating &lt;-<span class="st"> </span>function(data1, data2) {
  <span class="co">#----join dataframes</span>
  joined &lt;-<span class="st"> </span><span class="kw">st_join</span>(data1, data2, <span class="dt">join =</span> st_within)
  <span class="co">#----calculate the average rating of cultural venue types per LSOA</span>
  <span class="co">#https://stackoverflow.com/questions/11562656/calculate-the-mean-by-group</span>
  average &lt;-<span class="st"> </span><span class="kw">ddply</span>(joined, .(joined$LSOA11CD, joined$Cultural.Venue.Type), function(x) <span class="kw">mean</span>(x$rating))
  <span class="kw">names</span>(average) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;LSOA11CD&quot;</span>, <span class="st">&quot;cultural_venue_type&quot;</span>, <span class="st">&quot;culture_rating&quot;</span>)
  <span class="co">#----then use the spread function from the tidyr lib to turn long data into wide data - i.e. a column for each cultural venue type</span>
  <span class="co">#source----https://uc-r.github.io/tidyr</span>
  average &lt;-<span class="st"> </span>average %&gt;%<span class="st"> </span><span class="kw">spread</span>(cultural_venue_type, culture_rating)
  <span class="co">#----then use the rowSums function to average the ratings from all cultural venue type, skip NA values and create new column</span>
  average$culture_rating &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(average[,<span class="kw">sapply</span>(average, is.numeric)], <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
  <span class="kw">return</span>(average)
}

JoinCulture_NOreviews &lt;-<span class="st"> </span>function(data1, data2) {
  <span class="co">#----join dataframes</span>
  joined &lt;-<span class="st"> </span><span class="kw">st_join</span>(data1, data2, <span class="dt">join =</span> st_within)
  <span class="co">#----calculate the sum of reviews of cultural venue types per LSOA</span>
  <span class="co">#https://stackoverflow.com/questions/11562656/calculate-the-mean-by-group</span>
  count &lt;-<span class="st"> </span><span class="kw">ddply</span>(joined, .(joined$LSOA11CD, joined$Cultural.Venue.Type), function(x) <span class="kw">sum</span>(x$user_ratings_total))
  <span class="kw">names</span>(count) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;LSOA11CD&quot;</span>, <span class="st">&quot;cultural_venue_type&quot;</span>, <span class="st">&quot;culture_no_reviews&quot;</span>)
  <span class="co">#----then use the spread function from the tidyr lib to turn long data into wide data - i.e. a column for each cultural venue type</span>
  <span class="co">#source----https://uc-r.github.io/tidyr</span>
  count &lt;-<span class="st"> </span>count %&gt;%<span class="st"> </span><span class="kw">spread</span>(cultural_venue_type, culture_no_reviews)
  <span class="co">#----then use the rowSums function to sum up the reviews from all cultural venue type, skip NA values and create new column</span>
  count$culture_no_reviews &lt;-<span class="st"> </span><span class="kw">rowSums</span>(count[,<span class="kw">sapply</span>(count, is.numeric)], <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
  <span class="kw">return</span>(count)
}

JoinCulture_AVreviews &lt;-<span class="st"> </span>function(data1, data2) {
  <span class="co">#----join dataframes</span>
  joined &lt;-<span class="st"> </span><span class="kw">st_join</span>(data1, data2, <span class="dt">join =</span> st_within)
  <span class="co">#----calculate the average rating of cultural venue types per LSOA</span>
  <span class="co">#https://stackoverflow.com/questions/11562656/calculate-the-mean-by-group</span>
  average &lt;-<span class="st"> </span><span class="kw">ddply</span>(joined, .(joined$LSOA11CD, joined$Cultural.Venue.Type), function(x) <span class="kw">mean</span>(x$user_ratings_total))
  <span class="kw">names</span>(average) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;LSOA11CD&quot;</span>, <span class="st">&quot;cultural_venue_type&quot;</span>, <span class="st">&quot;culture_av_reviews&quot;</span>)
  <span class="co">#----then use the spread function from the tidyr lib to turn long data into wide data - i.e. a column for each cultural venue type</span>
  <span class="co">#source----https://uc-r.github.io/tidyr</span>
  average &lt;-<span class="st"> </span>average %&gt;%<span class="st"> </span><span class="kw">spread</span>(cultural_venue_type, culture_av_reviews)
  <span class="co">#----then use the rowSums function to average the reviews from all cultural venue type, skip NA values and create new column</span>
  average$culture_av_reviews &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(average[,<span class="kw">sapply</span>(average, is.numeric)], <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
  <span class="kw">return</span>(average)
}


<span class="co">#----////////////////////////////////////////////////////////////////////////</span>


<span class="co">#----CULTURE COUNT----#</span>
<span class="co">#----use the first function to count the number for each cultural venue category in each LSOA</span>
cultureLSOA_count &lt;-<span class="st"> </span><span class="kw">JoinCulture_count</span>(culture, londonLSOA)

<span class="co">#----CULTURE RATING----#</span>
<span class="co">#----use the second function to calculate the average rating of Google Places reviews for each cultural venue category in each LSOA</span>
cultureLSOA_rating &lt;-<span class="st"> </span><span class="kw">JoinCulture_rating</span>(culture, londonLSOA)

<span class="co">#----CULTURE NUMBER OF REVIEWS----#</span>
<span class="co">#----use the third function to count the number of Google Places reviews for each cultural venue category in each LSOA</span>
cultureLSOA_review_count &lt;-<span class="st"> </span><span class="kw">JoinCulture_NOreviews</span>(culture, londonLSOA)

<span class="co">#----CULTURE AVERAGE NUMBER OF REVIEWS----#</span>
<span class="co">#----use the third function to count the number of Google Places reviews for each cultural venue category in each LSOA</span>
cultureLSOA_review_average &lt;-<span class="st"> </span><span class="kw">JoinCulture_AVreviews</span>(culture, londonLSOA)</code></pre></div>
<p><strong>3. Join Airbnb, Culture and LSOA shapefile data</strong></p>
<p>Having done the previous calculations for Airbnb and Cultural Infrastructure per LSOA, all the data is joined together.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----merge all dataframes into one</span>
<span class="co">#https://stackoverflow.com/questions/8091303/simultaneously-merge-multiple-data-frames-in-a-list</span>
<span class="co">#install safejoin package from GitHub</span>
devtools::<span class="kw">install_github</span>(<span class="st">&quot;moodymudskipper/safejoin&quot;</span>)
<span class="kw">library</span>(safejoin)

<span class="co">#----use eat function from safejoin to merge a list of all the dataframes</span>
londonLSOAextradata &lt;-<span class="st"> </span><span class="kw">eat</span>(airbnbLSOA_count, <span class="kw">list</span>(airbnbLSOA_price, airbnbLSOA_review_count, airbnbLSOA_review_average, cultureLSOA_count, cultureLSOA_rating, cultureLSOA_review_count, cultureLSOA_review_average), <span class="dt">.by =</span> <span class="st">&quot;LSOA11CD&quot;</span>, <span class="dt">.conflict =</span> ~.x)</code></pre></div>
<p><strong>4. Join LSOA profile data to the rest</strong></p>
<p>Now that we have all of our data, we join them all together to create the londonLSOAProfiles sf object. Moreover, we caclulate the frequency density of cultural venue type per km^2 in every LSAO as per</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----merge the LSOA boundaries shapefile with the and LSOA attribute dataframe</span>
londonLSOAProfiles &lt;-<span class="st"> </span><span class="kw">inner_join</span>(londonLSOA, londonLSOAProfiles, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;LSOA11CD&quot;</span> =<span class="st"> &quot;Lower Super Output Area&quot;</span>))</code></pre></div>
<pre><code>## Warning: Column `LSOA11CD`/`Lower Super Output Area` joining factor and
## character vector, coercing into character vector</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#londonLSOAProfiles &lt;- na.omit(londonLSOAProfiles)</span>

<span class="co">#----join the extra data - Airbnb price &amp; counts and culture counts - to the LSAO profile data</span>
londonLSOAProfiles &lt;-<span class="st"> </span><span class="kw">inner_join</span>(londonLSOAProfiles, londonLSOAextradata, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;LSOA11CD&#39;</span>))</code></pre></div>
<pre><code>## Warning: Column `LSOA11CD` joining character vector and factor, coercing into
## character vector</code></pre>
<p><strong>5. Join Inner/Outer London boundaries with the data</strong></p>
<p>Inner/Outer London boundaries join with dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----join the shapefile to the LSOA SF obbject on geometry</span>
inner_outer_df &lt;-<span class="st"> </span><span class="kw">st_join</span>(londonLSOA, inner_outerSF, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;geometry&quot;</span> =<span class="st"> &quot;geometry&quot;</span>))
inner_outer_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(inner_outer_df)
<span class="kw">names</span>(inner_outer_df)[<span class="kw">names</span>(inner_outer_df) ==<span class="st"> &#39;Boundary&#39;</span>] &lt;-<span class="st"> &#39;InnerOuter&#39;</span>
select.me &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;LSOA11CD&#39;</span>,<span class="st">&#39;InnerOuter&#39;</span>)
inner_outer_df &lt;-<span class="st"> </span>inner_outer_df[,select.me]

<span class="co">#----join the Inner and Outer London extra data to the LSAO profile data</span>
londonLSOAProfiles &lt;-<span class="st"> </span><span class="kw">inner_join</span>(londonLSOAProfiles, inner_outer_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;LSOA11CD&quot;</span> =<span class="st"> &quot;LSOA11CD&quot;</span>))</code></pre></div>
<pre><code>## Warning: Column `LSOA11CD` joining character vector and factor, coercing into
## character vector</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----drop duplicate rows for LSOA11CD, culture_freq, airbnb_price, airbnb_freq columns</span>
londonLSOAProfiles &lt;-<span class="st"> </span>londonLSOAProfiles[!<span class="kw">duplicated</span>(londonLSOAProfiles[<span class="kw">c</span>(<span class="st">&quot;LSOA11CD&quot;</span>, <span class="st">&quot;culture_freq&quot;</span>, <span class="st">&quot;airbnb_price&quot;</span>, <span class="st">&quot;airbnb_freq&quot;</span>)]),]

<span class="co">#londonLSOAProfiles &lt;- londonLSOAProfiles[londonLSOAProfiles$InnerOuter == &#39;Inner London&#39;,]</span></code></pre></div>
</div>
<div id="clean-variables-before-analysis" class="section level2">
<h2><span class="header-section-number">3.4</span> Clean variables before analysis</h2>
<p>Some variable names are changed before the analysis for ease of use and also to align with Dudas et al (2017).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----change the column names of some of the independent variables</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;Population Density;Area (Hectares);&quot;</span>)] &lt;-<span class="st"> &quot;areaLSOA&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;Population Density;Persons per hectare;2013&quot;</span>)] &lt;-<span class="st"> &quot;pop_density&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;Ethnic Group;BAME (%);2011&quot;</span>)] &lt;-<span class="st"> &quot;bame_p&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;Country of Birth;% Not United Kingdom;2011&quot;</span>)] &lt;-<span class="st"> &quot;nonUK&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;Tenure;Owned outright (%);2011&quot;</span>)] &lt;-<span class="st"> &quot;house_own&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;Tenure;Owned with a mortgage or loan (%);2011&quot;</span>)] &lt;-<span class="st"> &quot;house_mortg&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;House Prices;Median Price (£);2014&quot;</span>)] &lt;-<span class="st"> &quot;house_price&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;Economic Activity;Employment Rate;2011&quot;</span>)] &lt;-<span class="st"> &quot;employees&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;Qualifications;% Highest level of qualification: Level 4 qualifications and above;2011&quot;</span>)] &lt;-<span class="st"> &quot;education&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;Household Income, 2011/12;Median Annual Household Income estimate (£)&quot;</span>)] &lt;-<span class="st"> &quot;income&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;Public Transport Accessibility Levels (2014);% 4-6 (good access)&quot;</span>)] &lt;-<span class="st"> &quot;transport&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;2013 Census Population;Age Structure;16-29&quot;</span>)] &lt;-<span class="st"> &quot;age16_29&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;2014 Census Population;Age Structure;30-44&quot;</span>)] &lt;-<span class="st"> &quot;age30_44&quot;</span>
<span class="kw">colnames</span>(londonLSOAProfiles)[<span class="kw">which</span>(<span class="kw">names</span>(londonLSOAProfiles) ==<span class="st"> &quot;Dwelling type;All Households;2011&quot;</span>)] &lt;-<span class="st"> &quot;housing&quot;</span>

<span class="co">#----change the some of the independent variables to density values by dividing by the area of the LSOA in hectares - areaLSOA</span>
londonLSOAProfiles$young_p &lt;-<span class="st"> </span>((londonLSOAProfiles$age16_29 +<span class="st"> </span>londonLSOAProfiles$age30_44)/londonLSOAProfiles$areaLSOA)*<span class="dv">100</span>
londonLSOAProfiles$housing &lt;-<span class="st"> </span>(londonLSOAProfiles$housing/londonLSOAProfiles$areaLSOA)*<span class="dv">100</span>

<span class="co">#----calculate the km^2 frequency density of Airbnb per LSAO (as per Dudas et al, 2017)</span>
londonLSOAProfiles$airbnb_freq &lt;-<span class="st"> </span>(londonLSOAProfiles$airbnb_freq/londonLSOAProfiles$areaLSOA)*<span class="dv">100</span>
londonLSOAProfiles$airbnb_no_reviews &lt;-<span class="st"> </span>(londonLSOAProfiles$airbnb_no_reviews/londonLSOAProfiles$areaLSOA)*<span class="dv">100</span>

<span class="co">#----find the column numbers for first and last cultural venue type</span>
<span class="kw">which</span>( <span class="kw">colnames</span>(londonLSOAProfiles)==<span class="st">&quot;Archives&quot;</span> )</code></pre></div>
<pre><code>## [1] 33</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">which</span>( <span class="kw">colnames</span>(londonLSOAProfiles)==<span class="st">&quot;culture_freq&quot;</span> )</code></pre></div>
<pre><code>## [1] 66</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#----function to change variable from freqency to freqency density per km2 by dividing by the LSOA hectare size and muliplying by 100</span>
A &lt;-<span class="st"> </span>function(x) (x /<span class="st"> </span>londonLSOAProfiles$<span class="st">`</span><span class="dt">areaLSOA</span><span class="st">`</span>)*<span class="dv">100</span>
<span class="co">#----calculate the km^2 frequency density of cultural venue type per LSAO (as per Dudas et al, 2017) </span>
londonLSOAProfiles[<span class="dv">33</span>:<span class="dv">66</span>] &lt;-<span class="st"> </span><span class="kw">lapply</span>(londonLSOAProfiles[<span class="dv">33</span>:<span class="dv">66</span>], A)</code></pre></div>
<pre><code>## Warning in `[&lt;-.data.frame`(`*tmp*`, 33:66, value = list(Archives =
## c(23.0769230769231, : provided 35 variables to replace 34 variables</code></pre>
<p>Create Dummy Variables for the rating and reviews of cultural infrastructure from Airbnb</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#https://support.google.com/business/answer/4801187?hl=en-GB rating criteria</span>
londonLSOAProfiles$culture_rating_good &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">as.numeric</span>(londonLSOAProfiles$culture_rating) &gt;=<span class="st"> </span><span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>)
<span class="kw">quantile</span>(londonLSOAProfiles$culture_av_reviews, <span class="fl">0.80</span>,  <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##      80% 
## 437.0026</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">londonLSOAProfiles$culture_reviews_popular &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">as.numeric</span>(londonLSOAProfiles$culture_av_reviews) &gt;=<span class="st"> </span><span class="dv">400</span>, <span class="dv">1</span>, <span class="dv">0</span>)


<span class="co"># londonLSOAProfiles &lt;- londonLSOAProfiles %&gt;%</span>
<span class="co">#   mutate(culture_rating_loved = as.numeric(culture_rating &gt;= quantile(culture_rating, 0.90, na.rm=TRUE)),</span>
<span class="co">#          culture_rating_liked = as.numeric(culture_rating &gt;= quantile(culture_rating, 0.75, na.rm=TRUE) &amp; culture_rating &lt; quantile(culture_rating, 0.90, na.rm=TRUE)),</span>
<span class="co">#          culture_rating_okay = as.numeric(culture_rating &gt;= quantile(culture_rating, 0.50, na.rm=TRUE) &amp; culture_rating &lt; quantile(culture_rating, 0.75, na.rm=TRUE)),</span>
<span class="co">#          culture_rating_disliked = as.numeric(culture_rating &gt;= quantile(culture_rating, 0.25, na.rm=TRUE) &amp; culture_rating &lt; quantile(culture_rating, 0.50, na.rm=TRUE)),</span>
<span class="co">#          culture_rating_hated = as.numeric(culture_rating &lt;= quantile(culture_rating, 0.25, na.rm=TRUE)))</span>

<span class="co"># londonLSOAProfiles &lt;- londonLSOAProfiles %&gt;%</span>
<span class="co">#   mutate(culture_rating_good = as.numeric(culture_rating &gt;= quantile(culture_rating, 0.50, na.rm=TRUE)),</span>
<span class="co">#          culture_rating_bad = as.numeric(culture_rating &lt; quantile(culture_rating, 0.50, na.rm=TRUE)))</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploratory-data-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-load-data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
